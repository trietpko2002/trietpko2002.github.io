<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KARAOKE PRO - LIST VIEW MODE</title>
    <style>
        :root { 
            --accent: #ff0055; 
            --bg: #0a0a0a; 
            --panel: #161616; 
            --card-bg: #1e1e1e;
            --text-main: #ffffff;
            --text-sub: #b0b0b0;
        }

        body { 
            margin: 0; 
            font-family: 'Segoe UI', Roboto, sans-serif; 
            background: var(--bg); 
            color: var(--text-main); 
            overflow: hidden; 
            user-select: none; 
        }
        
        .admin-layout { 
            display: grid; 
            grid-template-rows: 70px auto 240px; 
            height: 100vh; 
        }

        /* --- TOP BAR --- */
        .top-bar { 
            background: var(--panel); 
            display: flex; 
            align-items: center; 
            padding: 0 20px; 
            gap: 15px; 
            border-bottom: 1px solid #333; 
        }
        .btn-main { 
            padding: 12px 20px; 
            font-size: 15px; 
            font-weight: bold; 
            border: none; 
            border-radius: 8px; 
            color: white; 
            background: #333; 
            cursor: pointer; 
            transition: 0.2s;
        }
        .btn-main:active { transform: scale(0.95); opacity: 0.8; }
        .btn-main.primary { background: #007bff; box-shadow: 0 4px 15px rgba(0,123,255,0.3); }
        .btn-main.stop { background: #dc3545; }
        .btn-main.next { background: #28a745; }

        /* --- MAIN CONTENT --- */
        .content { 
            display: grid; 
            grid-template-columns: 1.4fr 0.6fr; 
            gap: 10px; 
            padding: 10px; 
            overflow: hidden; 
        }
        .box { 
            background: var(--panel); 
            border-radius: 12px; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            border: 1px solid #222; 
        }
        h3 { 
            padding: 12px 15px; 
            margin: 0; 
            background: #222; 
            font-size: 13px; 
            color: var(--text-sub); 
            text-transform: uppercase; 
            letter-spacing: 1px;
        }

        /* --- LIST VIEW RESULTS (L∆∞·ªõt danh s√°ch) --- */
        #results { 
            flex: 1; 
            overflow-y: auto; 
            padding: 10px; 
            display: flex; 
            flex-direction: column; 
            gap: 10px; 
        }
        .card { 
            display: flex; 
            background: var(--card-bg); 
            border-radius: 12px; 
            overflow: hidden; 
            border: 1px solid #333;
            min-height: 120px;
        }
        .thumb-container { 
            width: 210px; 
            min-width: 210px; 
            height: 120px; 
            background: #000;
        }
        .thumb-container img { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
        }
        .card-info { 
            flex: 1; 
            padding: 12px; 
            display: flex; 
            flex-direction: column; 
            justify-content: space-between; 
        }
        .card-info p { 
            margin: 0; 
            font-size: 16px; 
            font-weight: 600; 
            line-height: 1.4; 
            color: #fff;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .btn-group { 
            display: flex; 
            gap: 10px; 
            margin-top: 10px; 
        }
        .btn-group button { 
            flex: 1; 
            padding: 10px; 
            border: none; 
            border-radius: 6px; 
            color: white; 
            font-weight: bold; 
            font-size: 12px; 
            cursor: pointer; 
        }

        /* --- QUEUE LIST --- */
        #queue { flex: 1; overflow-y: auto; padding: 10px; }
        .q-item { 
            padding: 12px; 
            background: #222; 
            margin-bottom: 8px; 
            border-radius: 8px; 
            display: flex; 
            justify-content: space-between; 
            border: 1px solid #333; 
            font-size: 14px; 
        }

        /* --- KEYBOARD SECTION --- */
        .input-section { 
            background: #000; 
            padding: 10px; 
            border-top: 1px solid #333; 
        }
        .search-bar { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 10px; 
        }
        #searchInput { 
            flex: 1; 
            padding: 12px; 
            font-size: 24px; 
            background: #111; 
            color: #0f0; 
            border: 1px solid var(--accent); 
            border-radius: 8px; 
            outline: none; 
        }
        .keyboard { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 5px; 
        }
        .key { 
            width: calc(100% / 13 - 6px); 
            height: 50px; 
            background: #333; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            font-size: 18px; 
            font-weight: bold; 
        }
        .key:active { background: var(--accent); }
        .key.wide { width: calc(100% / 7); background: #444; }

    </style>
</head>
<body>

<div class="admin-layout">
    <div class="top-bar">
        <button id="btnConnect" class="btn-main primary" onclick="openDisplay()">üñ•Ô∏è K·∫æT N·ªêI TIVI</button>
        <button class="btn-main stop" onclick="stopCurrent()">‚èπÔ∏è D·ª™NG</button>
        <button class="btn-main next" onclick="playNext()">‚è≠Ô∏è QUA B√ÄI</button>
        <div id="status" style="margin-left: auto; color: #888;">Tr·∫°ng th√°i: Ch∆∞a k·∫øt n·ªëi</div>
    </div>

    <div class="content">
        <div class="box">
            <h3>DANH S√ÅCH B√ÄI H√ÅT T√åM TH·∫§Y</h3>
            <div id="results">
                <div style="padding: 20px; color: #555; text-align: center;">Vui l√≤ng nh·∫≠p t√™n b√†i h√°t ƒë·ªÉ t√¨m ki·∫øm...</div>
            </div>
        </div>
        <div class="box">
            <h3>B√ÄI ƒê√É CH·ªåN (<span id="count">0</span>)</h3>
            <div id="queue"></div>
        </div>
    </div>

    <div class="input-section">
        <div class="search-bar">
            <input type="text" id="searchInput" readonly placeholder="G√µ t√™n b√†i h√°t...">
            <button class="btn-main primary" onclick="searchVideo()" style="width: 150px;">T√åM B√ÄI</button>
        </div>
        <div class="keyboard" id="keyboard"></div>
    </div>
</div>

<script>
    // --- C·∫§U H√åNH API ---
    const API_KEY = 'AIzaSyC4vRYZrUOC3mFZUVSSsIJxGZNxY1E0JY8'; 
    let displayWindow = null;
    let playlist = [];

    // 1. M·ªü m√†n h√¨nh Tivi
    function openDisplay() {
        const features = 'width=1280,height=720,menubar=no,toolbar=no';
        displayWindow = window.open('', 'KaraokePlayer', features);
        
        if (!displayWindow) {
            alert("Vui l√≤ng cho ph√©p Pop-up tr√™n tr√¨nh duy·ªát!");
            return;
        }

        displayWindow.document.write(`
            <html><head><title>KARAOKE TIVI</title><style>body{margin:0;background:#000;overflow:hidden;}</style></head>
            <body><div id="player"></div>
            <script src="https://www.youtube.com/iframe_api"><\/script>
            <script>
                let player;
                function onYouTubeIframeAPIReady() {
                    player = new YT.Player('player', {
                        height: '100%', width: '100%',
                        playerVars: { 'autoplay': 1, 'controls': 0, 'rel': 0 },
                        events: { 'onStateChange': (e) => { if(e.data === 0) window.opener.playNext(); } }
                    });
                }
                function load(id) { if(player && player.loadVideoById) player.loadVideoById(id); }
                function stop() { if(player && player.stopVideo) player.stopVideo(); }
            <\/script></body></html>
        `);
        
        document.getElementById('status').innerText = "Tr·∫°ng th√°i: ƒêang k·∫øt n·ªëi ‚úÖ";
        document.getElementById('status').style.color = "#28a745";
    }

    // 2. B√†n ph√≠m ·∫£o
    const layout = "1234567890QWERTYUIOPASDFGHJKLZXCVBNM".split("");
    const kb = document.getElementById('keyboard');
    layout.forEach(c => {
        const b = document.createElement('button');
        b.className = 'key'; b.innerText = c;
        b.onclick = () => document.getElementById('searchInput').value += c;
        kb.appendChild(b);
    });
    
    const addFnKey = (txt, fn) => {
        const b = document.createElement('button');
        b.className = 'key wide'; b.innerText = txt; b.onclick = fn;
        kb.appendChild(b);
    };
    addFnKey('C√ÅCH', () => document.getElementById('searchInput').value += ' ');
    addFnKey('X√ìA', () => { let v = document.getElementById('searchInput').value; document.getElementById('searchInput').value = v.slice(0,-1); });
    addFnKey('X√ìA H·∫æT', () => document.getElementById('searchInput').value = '');

    // 3. T√¨m ki·∫øm v√† Hi·ªÉn th·ªã List View
    async function searchVideo() {
        const query = document.getElementById('searchInput').value;
        if(!query) return;
        const resDiv = document.getElementById('results');
        resDiv.innerHTML = "<div style='padding:20px; text-align:center;'>ƒêang t√¨m b√†i h√°t...</div>";
        
        try {
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query + " karaoke")}&type=video&videoEmbeddable=true&maxResults=15&key=${API_KEY}`;
            const res = await fetch(url);
            const data = await res.json();
            
            if(data.items.length === 0) {
                resDiv.innerHTML = "<div style='padding:20px; text-align:center;'>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£.</div>";
                return;
            }

            resDiv.innerHTML = data.items.map(item => `
                <div class="card">
                    <div class="thumb-container">
                        <img src="${item.snippet.thumbnails.medium.url}" alt="thumb">
                    </div>
                    <div class="card-info">
                        <p>${item.snippet.title}</p>
                        <div class="btn-group">
                            <button style="background:#444;" onclick="addToQueue('${item.id.videoId}', '${item.snippet.title.replace(/'/g,"")}', false)">CH·ªåN B√ÄI</button>
                            <button style="background:var(--accent);" onclick="addToQueue('${item.id.videoId}', '${item.snippet.title.replace(/'/g,"")}', true)">∆ØU TI√äN</button>
                        </div>
                    </div>
                </div>
            `).join('');
        } catch(e) { 
            resDiv.innerHTML = "<div style='padding:20px; color:red; text-align:center;'>L·ªói API! Vui l√≤ng ki·ªÉm tra l·∫°i Key ho·∫∑c h·∫°n ng·∫°ch.</div>"; 
        }
    }

    // 4. Qu·∫£n l√Ω ph√°t nh·∫°c
    function addToQueue(id, title, priority) {
        const song = {id, title};
        if(priority) playlist.unshift(song); else playlist.push(song);
        updateUI();
        if(playlist.length === 1 && !priority) playNext();
        // X√≥a √¥ t√¨m ki·∫øm sau khi ch·ªçn ƒë·ªÉ ng∆∞·ªùi kh√°c g√µ
        document.getElementById('searchInput').value = '';
    }

    function playNext() {
        if(!displayWindow || displayWindow.closed) {
            alert("Ch∆∞a k·∫øt n·ªëi m√†n h√¨nh Tivi!"); return;
        }
        if(playlist.length > 0) {
            const nextSong = playlist.shift();
            displayWindow.load(nextSong.id);
            updateUI();
        }
    }

    function stopCurrent() { if(displayWindow) displayWindow.stop(); }

    function updateUI() {
        document.getElementById('count').innerText = playlist.length;
        document.getElementById('queue').innerHTML = playlist.map((s, i) => `
            <div class="q-item">
                <span><b>${i+1}.</b> ${s.title}</span>
                ${i===0 ? '<span style="color:#28a745; font-weight:bold; font-size:10px;">ƒêANG CH·ªú PH√ÅT</span>' : ''}
            </div>
        `).join('');
    }
</script>
</body>
</html>